<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<title>Anketa</title>
</h:head>

<f:metadata>
	<f:viewAction
		action="#{navigationController.checkLoggedUserWithoutApproved}" />
	<f:viewAction action="#{userLoginController.collectMyReservations}" />
</f:metadata>

<h:body>
	<ui:composition template="/template/common/commonLayout.xhtml">
		<ui:define name="content">
			<f:view>
				<h1 align="center">Vartotojo profilis</h1>
				<h:form>

					<h:panelGrid columns="2" columnClasses="column" cellpadding="5">

						<h:outputLabel value="Vardas:"/>

						<p:inputText value="#{userLoginController.loggedUser.firstName}"
									 required="true"
									 validatorMessage="Vardas gali susidėti tik iš raidžių!"
									 label="text"
									 title="Redaguoti">
							<f:validateRegex pattern="[a-zA-Z]+" />
						</p:inputText>

						<h:outputLabel value="Pavardė:"/>

						<p:inputText value="#{userLoginController.loggedUser.lastName}"
									 required="true"
									 validatorMessage="Pavardė gali susidėti tik iš raidžių!"
									 label="text"
									 title="Redaguoti">
							<f:validateRegex pattern="[a-zA-Z]+" />
						</p:inputText>

						<h:outputLabel value="El. paštas:"/>
						<p:inputText readonly="true" value="#{userLoginController.loggedUser.email}"/>

						<h:outputLabel value="Statusas:"/>
						<p:inputText readonly="true"  value="#{userLoginController.loggedUser.approvedString}"/>

						<h:outputLabel value="Turimi taškai:" rendered="#{userLoginController.loggedUser.approved}"/>
						<p:inputText readonly="true"  value="#{userLoginController.loggedUser.points}" rendered="#{userLoginController.loggedUser.approved}"/>

						<h:outputLabel value="Priklauso grupei:"/>
						<p:inputText readonly="true" value="#{userLoginController.loggedUser.groupNumber}"/>
					</h:panelGrid>
					<div align="center">
						<p:commandButton value="Išsaugoti pakeitimus" actionListener="#{userLoginController.updateUser}" onsuccess="PF('infoUpdateConfirmDialog').show();"/>
					</div>

					<div align="center">
						<p:fileUpload id="image" label="Pridėti nuotrauką"
									  value="#{userLoginController.image}" mode="simple"
									  skinSimple="true" styleClass="btn" />

						<p:commandButton id="save" value="Išsaugoti nuotrauką"
										 ajax="false" actionListener="#{userLoginController.uploadImage}"
										 update="" />

					</div>

					<p:dialog header="Patvirtinimas" widgetVar="infoUpdateConfirmDialog"
							  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
						<p:outputPanel style="text-align:center;">
							<p:panelGrid>

								<h:outputText value="Informacija atnaujinta!"/><br/>
								<p:commandButton value="Grįžti" oncomplete="/loggedUserDetails.xhtml?faces-redirect=true"/>

							</p:panelGrid>
						</p:outputPanel>
					</p:dialog>


				</h:form>

				<h:form id="form"
						rendered="#{not empty userLoginController.loggedUser}">

					<p:growl styleClass="top" id="msgs" showDetail="true"  />

					<p:dataTable id="singleDT" var="reservation"
								 value="#{userLoginController.myReservations}"
								 selectionMode="single"
								 selection="#{userLoginController.selectedReservation}"
								 rowKey="#{reservation.id}"
								 rendered="#{userLoginController.loggedUser.approved}">
						<f:facet name="header">
							Rezervacijos
						</f:facet>
						<p:column headerText="Rezervacijos nr." sortBy="#{reservation.number}">
							<h:outputText value="#{reservation.number}" />
						</p:column>
						<p:column headerText="Data nuo" sortBy="#{reservation.dateFrom}">
							<h:outputText value="#{reservation.dateFrom}" />
						</p:column>
						<p:column headerText="Data iki" sortBy="#{reservation.dateTo}">
							<h:outputText value="#{reservation.dateTo}" />
						</p:column>
						<p:column headerText="Vasarnamis" sortBy="#{reservation.reservedSummerhouse.title}">
							<h:outputText value="#{reservation.reservedSummerhouse.title}" />
						</p:column>
						<p:column headerText="Kaina" sortBy="#{reservation.price}">
							<h:outputText value="#{reservation.price}" />
						</p:column>

						<f:facet name="footer">
							<p:commandButton id="cancelReservation" value="Atšaukti rezervaciją" update="@form"
											 action="#{userLoginController.checkReservation}"/>
						</f:facet>
					</p:dataTable>

					<p:dialog header="Patvirtinimas" widgetVar="cancelReservationDialog"
							  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
						<p:outputPanel id="summerhousesDetail2" style="text-align:center;">
							<p:panelGrid columns="1">

								<h:outputText value="Ar tikrai norite atšaukti šią rezervaciją?"/>

								<p:commandButton value="Patvirtinti" oncomplete="PF('cancelReservationDialog').hide()"
												 update="@form,msgs" action="#{userLoginController.cancelReservation}"/>

								<p:commandButton value="Grįžti" oncomplete="PF('cancelReservationDialog').hide()"/>

							</p:panelGrid>
						</p:outputPanel>
					</p:dialog>

				</h:form>
			</f:view>
		</ui:define>
	</ui:composition>
</h:body>
</html>
