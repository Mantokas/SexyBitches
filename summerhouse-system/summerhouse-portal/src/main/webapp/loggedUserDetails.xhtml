<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<title>Anketa</title>
</h:head>

<f:metadata>
	<f:viewAction
            action="#{navigationController.checkLoggedUserWithoutApproved}" />
	<f:viewAction
            action="#{userLoginController.collectMyReservations}" />
    <f:viewAction
            action="#{userLoginController.updateLoggedUser}" />
</f:metadata>

<h:body>
	<ui:composition template="/template/common/commonLayout.xhtml">
		<ui:define name="content">
			<f:view>

				<h:form enctype="multipart/form-data" id="form1" >
					<h2 align="center">Vartotojo profilis</h2>
					<h:panelGrid columns="1" styleClass="panel panel-default">
						<h:graphicImage
								value="#{userLoginController.loggedUser.encodedImage}"
								styleClass="user-view-img" />
					</h:panelGrid>
					<h:panelGrid id="profileGrid" columns="2" columnClasses="column" cellpadding="5" styleClass="panel panel-default" style=" padding: 10px; border-collapse: inherit;">
						<h:outputLabel value="Vardas: " />
						<p:inputText value="#{userLoginController.loggedUser.firstName}"
									 required="true"
									 validatorMessage="Vardas gali susidėti tik iš raidžių!"
									 label="text"
									 title="Redaguoti"
									 disabled="#{!userLoginController.editable}">
							<f:validateRegex pattern="[a-zA-ZČčĄąĘęĖėĮįŠšŲųŪū]+" />
						</p:inputText>

						<h:outputLabel value="Pavardė: "/>

						<p:inputText value="#{userLoginController.loggedUser.lastName}"
									 required="true"
									 validatorMessage="Pavardė gali susidėti tik iš raidžių!"
									 label="text"
									 title="Redaguoti"
									 disabled="#{!userLoginController.editable}">
							<f:validateRegex pattern="[a-zA-ZA-ZČčĄąĘęĖėĮįŠšŲųŪū]+" />
						</p:inputText>

						<h:outputLabel value="El. paštas: "/>
						<p:inputText readonly="true"
									 disabled="#{!userLoginController.editable}"
									 value="#{userLoginController.loggedUser.email}"/>

						<h:outputLabel value="Statusas: "/>
						<p:inputText readonly="true"
									 value="#{userLoginController.loggedUser.approvedString}"
									 disabled="true"/>

						<h:outputLabel value="Turimi taškai: "
							rendered="#{userLoginController.loggedUser.approved}" />
						<p:inputText readonly="true"
									 value="#{userLoginController.loggedUser.points}"
							         rendered="#{userLoginController.loggedUser.approved}"
									 disabled="true"/>

						<h:outputLabel value="Priklauso grupei: " />
						<p:inputText readonly="true"
							         value="#{userLoginController.loggedUser.groupNumber}"
									 disabled="true"/>

						<h:outputLabel value="Narystė galioja iki: " />
						<p:inputText readonly="true"
									 value="Negalioja" rendered="#{userLoginController.loggedUser.validTo == null}"
						             disabled="true"/>
                        <p:inputText readonly="true"
                                     value="#{userLoginController.loggedUser.validTo}" rendered="#{userLoginController.loggedUser.validTo != null}"
                                     disabled="true"/>

                        <h:outputLabel value="Skype vardas: " rendered="#{userLoginController.skypeNameEnabled}"/>
                        <p:inputText readonly="true"
                                     value="#{userLoginController.loggedUser.skypeName}"
									 disabled="#{!userLoginController.editable}"
									 rendered="#{userLoginController.skypeNameEnabled}"/>

                        <h:outputLabel value="Tel.nr.: " rendered="#{userLoginController.phoneNumberEnabled}"/>
                        <p:inputText readonly="true"
                                     value="#{userLoginController.loggedUser.phoneNumber}"
									 disabled="#{!userLoginController.editable}"
                                     rendered="#{userLoginController.phoneNumberEnabled}"/>

                        <h:outputLabel value="Aprašymas: " rendered="#{userLoginController.descriptionEnabled}"/>
                        <p:inputText readonly="true"
                                     value="#{userLoginController.loggedUser.description}"
									 disabled="#{!userLoginController.editable}"
                                     rendered="#{userLoginController.descriptionEnabled}"/>
					</h:panelGrid>


					<div id="addPhoto" align="center" style="display: none">
						<p:fileUpload id="image" label="Pridėti nuotrauką"
									  value="#{userLoginController.image}" mode="simple"
									  skinSimple="true" styleClass="btn" />
					</div>

					<div id="saveChanges" align="center" style="display: none">
						<p:commandButton value="Išsaugoti pakeitimus" actionListener="#{userLoginController.updateUser}" onsuccess="PF('infoUpdateConfirmDialog').show();" ajax="false"/>
					</div>

					<div id="edit" align="center" style="display: block; margin-bottom: 20px;">
						<p:commandButton value="Redaguoti duomenis" onclick="changeButtonsState('saveChanges', 'edit', 'addPhoto'); " update="profileGrid" actionListener="#{userLoginController.doEdit}"/>
					</div>

					<p:confirmDialog header="Patvirtinimas"
						widgetVar="infoUpdateConfirmDialog" modal="true" showEffect="fade"
						hideEffect="fade" resizable="false">
						<p:outputPanel style="text-align:center;">
							<p:panelGrid>

								<h:outputText value="Informacija atnaujinta!"/><br/>
								<p:commandButton value="Gerai" oncomplete="/loggedUserDetails.xhtml?faces-redirect=true"/>

							</p:panelGrid>
						</p:outputPanel>
					</p:confirmDialog>

				</h:form>

				<h:form id="form2"
						rendered="#{userLoginController.loggedUser != null}">

					<p:growl styleClass="top" id="msgs" showDetail="true" />

					<p:dataTable id="singleDT" var="reservation"
								 styleClass="panel panel-default"
						value="#{userLoginController.myReservations}"
						selectionMode="single"
						selection="#{userLoginController.selectedReservation}"
						rowKey="#{reservation.id}"
						rendered="#{userLoginController.loggedUser.approved}" emptyMessage="Vartotojas neturi rezervacijų">
						<f:facet name="header">
							Rezervacijos
						</f:facet>
						<p:column headerText="Rezervacijos nr."
							sortBy="#{reservation.number}">
							<h:outputText value="#{reservation.number}" />
						</p:column>
						<p:column headerText="Data nuo" sortBy="#{reservation.dateFrom}">
							<h:outputText value="#{reservation.dateFrom}" />
						</p:column>
						<p:column headerText="Data iki" sortBy="#{reservation.dateTo}">
							<h:outputText value="#{reservation.dateTo}"/>
						</p:column>
						<p:column headerText="Vasarnamis"
							sortBy="#{reservation.reservedSummerhouse.title}">
							<h:outputText value="#{reservation.reservedSummerhouse.title}" />
						</p:column>
						<p:column headerText="Kaina" sortBy="#{reservation.price}">
							<h:outputText value="#{reservation.price}" />
						</p:column>

						<f:facet name="footer">
							<p:commandButton id="cancelReservation" value="Atšaukti rezervaciją" update="@form"
											 action="#{userLoginController.checkReservation}"/>
						</f:facet>
					</p:dataTable>

					<p:dialog header="Patvirtinimas" widgetVar="cancelReservationDialog"
							  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
						<p:outputPanel id="summerhousesDetail2" style="text-align:center;">
							<p:panelGrid columns="1">

								<h:outputText value="Ar tikrai norite atšaukti šią rezervaciją?"/>

								<p:commandButton value="Patvirtinti" oncomplete="PF('cancelReservationDialog').hide()"
												 update="@form,msgs,form1" action="#{userLoginController.cancelReservation}"/>

								<p:commandButton value="Grįžti" oncomplete="PF('cancelReservationDialog').hide()"/>

							</p:panelGrid>
						</p:outputPanel>
					</p:dialog>

				</h:form>

				<h:form style="padding-left: 10px; margin-bottom: 20px;">
					<p:commandButton styleClass="btn btn-lg btn-success"
									 value="Sumokėti metinį narystės mokestį" type="submit"
									 action="#{navigationController.goToPayment}" immediate="true"/>

				</h:form>

				<h:outputScript>
					//<![CDATA[

                function changeButtonsState(id, id2, id3) {
					document.getElementById(id3).style.display = 'block'
					document.getElementById(id).style.display = 'block'
					document.getElementById(id2).style.display = 'none'
                };

                //]]>
				</h:outputScript>
			</f:view>
		</ui:define>
	</ui:composition>
</h:body>
</html>
